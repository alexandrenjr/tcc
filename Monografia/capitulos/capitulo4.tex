\chapter{Testes e Simulações}

Para ilustrar o funcionamento dos algoritmos, foi proposta uma planta hidráulica composta por um sistema de tanques comunicantes. A figura \ref{fig:TanquesComunicantes} mostra um esboço de tal sistema. O tanque com capactância $C_1$ é interligado com um de capacitância $C_2$. Aquele é alimentado por uma vazão $q$ e é drenado por uma vazão $q_1$. Tal grandeza é controlada por um registro, que pode ser enxergado como um resistor de resistência $R_1$.

Ainda, devido à ligação, a vazão de saída do primeiro tanque é a entrada do segundo. Este é drenado por uma vazão $q_2$, onde é controlado por um registro $R_2$. A variável controlada é a diferença $h_1 - h_2$.

\begin{figure}[!ht]
  \centering
  \input{figuras/tanques_comunicantes.tikz}
  \caption{Tanques comunicantes.}
  \label{fig:TanquesComunicantes}
\end{figure}

\section{Modelagem via espaço de estados}
Para a representação via espaço de estados, define-se as variáveis de estado $x_1 = q_1$ e $x_2 = q_2$. A partir das relações entre capacitância e vazão, chega-se a seguinte representação no espaço de estados:
\begin{subequations}
  \begin{align}
    \dot{\pmb{\mathrm{x}}} &= \begin{bmatrix*}[c]
      -(R_1C_{eq})^{-1} & (R_1C_2)^{-1}\\
      (R_2C_2)^{-1} & -(R_2C_2)^{-1}
    \end{bmatrix*}\pmb{\mathrm{x}} + \begin{bmatrix*}[c]
      (R_1C_1)^{-1}\\
      0
    \end{bmatrix*}\pmb{\mathrm{u}}\label{eq:SSTCEntrada}\\
    \pmb{\mathrm{y}} &= \begin{bmatrix*}[c]
      R_1 & 0
    \end{bmatrix*}\pmb{\mathrm{x}}\label{eq:SSTCSaida}
  \end{align}
\end{subequations}
onde $C_{eq} = C_1C_2/(C_1 + C_2)$. Para discretizar o sistema, é preciso de um valor para o período de amostragem $T_s$. A transformada usada será a bilinear de Tustin, dada por:
\begin{equation}
  \s = \dfrac{2}{T_s}\dfrac{\z-1}{\z+1}\label{eq:BilinearTransform}
\end{equation}
onde o semi-plano esquerdo dos contínuos é mapeado no círculo unitário dos discretos.

\section{Parâmetros de projeto}
Com posse do espaço de estados, é possível sintetizar uma matriz de ganho $K$ que possa estabilizar o sistema. Antes, é necessário atribuir valores para a planta. Em um primeiro projeto, serão escolhidas arbitrariamente tais valores, como segue:
\begin{itemize}
  \item $C_1 = C_2 = 5$;
  \item $R_1 = R_2 = 1$;
  \item $T_s = \SI{10}{\second}$.
\end{itemize}

Assim, a representação via espaço de estados da planta nos contínuos é:
\begin{subequations}
  \begin{align}
    \dot{\pmb{\mathrm{x}}} &= \begin{bmatrix*}[c]
      -0.4 & -0.2\\
      0.2 & -0.2
    \end{bmatrix*}\pmb{\mathrm{x}} + \begin{bmatrix*}[c]
      0.2\\
      0
    \end{bmatrix*}\pmb{\mathrm{u}}\label{eq:SSCTCEntrada}\\
    \pmb{\mathrm{y}} &= \begin{bmatrix*}[c]
      1 & 0
    \end{bmatrix*}\pmb{\mathrm{x}}\label{eq:SSCTCSaida}
  \end{align}
\end{subequations}

Através do função \texttt{c2d} disponibilizada no MATLAB, a transformação bilinear é realizada, resultando em:
\begin{subequations}
  \begin{align}
    \pmb{\mathrm{x^{+}}} &= \begin{bmatrix*}[c]
      -0.4286 & -0.2857\\
      0.2857 & -0.1429
    \end{bmatrix*}\pmb{\mathrm{x}} + \begin{bmatrix*}[c]
      0.5714\\
      0.2857
    \end{bmatrix*}\pmb{\mathrm{u}}\label{eq:SSDTCEntrada}\\
    \pmb{\mathrm{y}} &= \begin{bmatrix*}[c]
      0.2857 & -0.1426
    \end{bmatrix*}\pmb{\mathrm{x}} + \begin{bmatrix*}[c]
      0.2857
    \end{bmatrix*}\pmb{\mathrm{u}}\label{eq:SSDTCSaida}
  \end{align}
\end{subequations}

A característica notória obtida é a presença da matriz $D$ no sistema discretizado. É um consequência da transformação bilinear: surgimento de transmissão direta. Com posse das matrizes obtidas na representação via espaço de estados, é possível escolher os parâmetros de projeto:
\begin{itemize}
  \item $t_s = \SI{50}{\second}$;
  \item $\zeta = 0.5 \implies M_p \leq 0.16$;
  \item $\omega_n = \SI{0.1}{\radian/\second}$.
\end{itemize}

Neste caso, o raio da circunferência relativo à estabilidade possui valor igual à $0.4493$. Ainda, a constante $N_y$ possui o valor de $6.2832$, acima do recomendado. Além disso, a maior frequencia natural não-amortecida de malha aberta do sistema discretizado possui o valor igual a $\SI{0.3780}{\radian/\second}$.

Ao executar o algoritmo utilizando a aproximação cônica, a solução proposta é infactível. Ao checar a solução, apenas houve uma infactibilidade em relação à taxa de amortecimento. Tal fenômeno é comum em solucionadores numéricos, uma vez que podem admitir uma certa infactibilidade. A figura \ref{subfig:TesteC} mostra o diagrama de polos do sistema compensado. É possível notar que o sistema é estável, mesmo com a negativa do algoritmo.

\begin{figure}[!ht]
  \centering
  \begin{subfigure}[t]{0.3\columnwidth}
    \input{figuras/pzmap_testeC.tikz}
      \caption{}
      \label{subfig:TesteC}
  \end{subfigure}
  \begin{subfigure}[t]{0.3\columnwidth}
    \input{figuras/pzmap_testeE.tikz}
      \caption{}
      \label{subfig:TesteE}
  \end{subfigure}
  \begin{subfigure}[t]{0.3\columnwidth}
    \input{figuras/pzmap_testeP.tikz}
    \caption{}
    \label{subfig:TesteP}
  \end{subfigure}
  \caption{Diagrama de polos do sistema compensado com a matriz de ganho $K$ obtidos na \subref{subfig:TesteC}aproximação cônica, \subref{subfig:TesteE} elíptica e \subref{subfig:TesteP} poligonal.}
  \label{fig:PrimeiroTeste}
\end{figure}

O valor da matriz $K$ que estabiliza o sistema é:
\begin{equation}
  K = \left[2.5358 \enspace -0.1842\right]\label{res:GanhoC}
\end{equation}

A resposta ao impulso para o sistema em malha fechada está representada na figura \ref{fig:ImpulseC}. O máximo sobressinal é de aproximadamente $5,21\%$, bem abaixo do requisito de projeto.  Como os parâmentros de projeto foram escolhidas arbitrariamente, o tempo de acomodação exigido é maior do que o sistema em malha aberta. Mesmo assim, o algoritmo conseguiu respeitar o requisito.

\begin{figure}[!ht]
  \centering
  \input{figuras/tc_impulse_C.tikz}
  \caption{Resposta ao impulso do sistema compensado a partir da aproximação cônica.}
  \label{fig:ImpulseC}
\end{figure}

Para a aproximação elíptica, o algoritmo retornou uma solução factível. É esperado devido o melhor aproveitamento da região $\omega_n$-constante. A figura \ref{fig:ImpulseE} mostra o diagrama de polos do sistema compensando. A matriz de ganho $K$ possui o seguinte valor:

\begin{equation}
  K = \left[2.5076 \enspace -0.1807\right]\label{res:GanhoE}
\end{equation}

\begin{figure}[!ht]
  \centering
  \input{figuras/tc_impulse_E.tikz}
  \caption{Resposta ao impulso do sistema compensado a partir da aproximação elíptica.}
  \label{fig:ImpulseE}
\end{figure}

Já para a aproximação polígonal, o algoritmo retornou uma solução factível com duas iterações. As regiões aproximadas foram representadas na figura \ref{fig:ImpulseP} e a matriz de ganho $K$ é dado por:

\begin{equation}
  K = \left[2.4159 \enspace -0.1554\right]\label{res:GanhoP}
\end{equation}

\begin{figure}[!ht]
  \centering
  \input{figuras/tc_impulse_P.tikz}
  \caption{Resposta ao impulso do sistema compensado a partir da aproximação poligonal.}
  \label{fig:ImpulseP}
\end{figure}